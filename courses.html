<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Find the right First Aid course for you. Answer a few quick questions and get a personalised recommendation. CPR, First Aid, Childcare & Advanced courses. RTO #32221.">
    <title>Find Your Course | Coral Sea Training | RTO #32221</title>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XXXXXXXXXX');
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=DM+Serif+Display&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='46' fill='%231B8A3D' stroke='%23D90A0A' stroke-width='6'/%3E%3Ctext x='50' y='68' text-anchor='middle' fill='white' font-size='50' font-weight='bold'%3E+%3C/text%3E%3C/svg%3E">
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="container">
            <div class="header-inner">
                <a href="index.html" class="logo">
                    <div class="logo-mark">+</div>
                    <div class="logo-text">
                        <span class="logo-name">Coral Sea Training</span>
                        <span class="logo-tagline">RTO #32221</span>
                    </div>
                </a>
                <nav class="nav">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="about.html" class="nav-link">About</a>
                    <a href="courses.html" class="nav-link active">Courses</a>
                    <a href="shop.html" class="nav-link">Shop</a>
                    <a href="contact.html" class="nav-link">Contact</a>
                </nav>
                <div class="header-actions">
                    <a href="tel:0419675022" class="header-phone">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                        0419 675 022
                    </a>
                    <a href="tel:0419675022" class="btn btn-primary">Call Us</a>
                    <button class="mobile-toggle" id="mobileToggle" aria-label="Menu">
                        <span></span><span></span><span></span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html" class="nav-link">Home</a>
        <a href="about.html" class="nav-link">About</a>
        <a href="courses.html" class="nav-link active">Courses</a>
        <a href="shop.html" class="nav-link">Shop</a>
        <a href="contact.html" class="nav-link">Contact</a>
    </div>

    <!-- Urgency Banner -->
    <div class="urgency-banner" id="urgencyBanner">
        <div class="container">
            <p class="urgency-text">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                <strong>Only 4 Spots Left:</strong> Next Townsville course Feb 22 &mdash; <a href="#" onclick="selectType('individual', document.querySelector('#step-type .funnel-option'));return false;">Book now before it fills</a>
            </p>
        </div>
    </div>

    <!-- Funnel Section -->
    <section class="funnel-section">
        <div class="container">
            <div class="funnel-wrapper">

                <!-- Progress Bar -->
                <div class="funnel-progress-wrapper">
                    <div class="funnel-progress-bar">
                        <div class="funnel-progress-fill" id="progressFill" style="width: 20%"></div>
                    </div>
                    <span class="funnel-step-label" id="stepLabel">Takes 30 seconds</span>
                </div>

                <!-- Social Proof Banner -->
                <div class="funnel-social-proof">
                    <span class="funnel-social-stars">&#9733;&#9733;&#9733;&#9733;<span style="opacity:0.3;">&#9733;</span></span>
                    <span>Rated <strong>4.4/5</strong> by <strong>10,000+</strong> Queenslanders</span>
                </div>

                <!-- ===== STEP: Type (Individual or Team) ===== -->
                <div class="funnel-step active" id="step-type">
                    <div class="funnel-step-header">
                        <h1 class="funnel-title">Find Your Perfect Course in 30 Seconds</h1>
                        <p class="funnel-subtitle">Two quick taps and we'll recommend the exact certification you need.</p>
                    </div>

                    <div class="funnel-options funnel-options-2">
                        <button class="funnel-option" onclick="selectType('individual', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>Just Me</h3>
                                <p>Get my own certification fast</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>

                        <button class="funnel-option" onclick="selectType('team', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>My Team</h3>
                                <p>Get volume discounts for 4+ people</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- ===== STEP: Industry (Individual path) ===== -->
                <div class="funnel-step" id="step-industry">
                    <div class="funnel-step-header">
                        <h2 class="funnel-title">Do You Work in Childcare or Education?</h2>
                        <p class="funnel-subtitle">This determines which certification you need.</p>
                    </div>

                    <div class="funnel-options funnel-options-2">
                        <button class="funnel-option" onclick="selectIndustry('childcare', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>Yes, Childcare / Education</h3>
                                <p>I need ACECQA-approved training</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>

                        <button class="funnel-option" onclick="selectIndustry('other', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>No, Another Industry</h3>
                                <p>Workplace, personal, or general first aid</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>
                    </div>

                    <button class="funnel-back" onclick="goBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polyline points="15 18 9 12 15 6"/></svg>
                        Back
                    </button>
                </div>

                <!-- ===== STEP: Partner Business (Team path) ===== -->
                <div class="funnel-step" id="step-partner">
                    <div class="funnel-step-header">
                        <h2 class="funnel-title">Are You a Partner Business?</h2>
                        <p class="funnel-subtitle">Partner businesses get priority scheduling and exclusive rates.</p>
                    </div>

                    <div class="funnel-options funnel-options-2">
                        <button class="funnel-option" onclick="selectPartner('yes', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>Yes</h3>
                                <p>We're already a Coral Sea partner</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>

                        <button class="funnel-option" onclick="selectPartner('interested', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>No, but I'd Like to Be</h3>
                                <p>Tell me about partner benefits</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>
                    </div>

                    <button class="funnel-back" onclick="goBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polyline points="15 18 9 12 15 6"/></svg>
                        Back
                    </button>
                </div>

                <!-- ===== STEP: Delivery (Team path) ===== -->
                <div class="funnel-step" id="step-delivery">
                    <div class="funnel-step-header">
                        <h2 class="funnel-title">Would You Like Us to Come to You?</h2>
                        <p class="funnel-subtitle">We bring all equipment &mdash; all you need is a room and your team.</p>
                    </div>

                    <div class="funnel-options funnel-options-2">
                        <button class="funnel-option" onclick="selectDelivery('onsite', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>Yes, Come to Our Workplace</h3>
                                <p>We bring everything to you &mdash; zero travel for your team</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>

                        <button class="funnel-option" onclick="selectDelivery('venue', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>No, We'll Go to Your Venue</h3>
                                <p>Our team attends a scheduled course at your location</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>
                    </div>

                    <button class="funnel-back" onclick="goBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polyline points="15 18 9 12 15 6"/></svg>
                        Back
                    </button>
                </div>

                <!-- ===== STEP: Course Level (Individual non-childcare) ===== -->
                <div class="funnel-step" id="step-level">
                    <div class="funnel-step-header">
                        <h2 class="funnel-title">What Level of Training Do You Need?</h2>
                        <p class="funnel-subtitle">Not sure? Most employers require Provide First Aid (HLTAID011).</p>
                    </div>

                    <div class="funnel-options funnel-options-2">
                        <button class="funnel-option" onclick="selectLevel('cpr', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>Just CPR</h3>
                                <p>Annual refresh &mdash; 3 hours, in and out</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>

                        <button class="funnel-option" onclick="selectLevel('firstaid', this)">
                            <div class="funnel-option-icon" style="background: var(--red-light);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--red);"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>Full First Aid</h3>
                                <p>CPR included &mdash; the complete workplace certification</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>
                    </div>

                    <button class="funnel-back" onclick="goBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polyline points="15 18 9 12 15 6"/></svg>
                        Back
                    </button>
                </div>

                <!-- ===== STEP: Location ===== -->
                <div class="funnel-step" id="step-location">
                    <div class="funnel-step-header">
                        <h2 class="funnel-title">Which Location Works Best?</h2>
                        <p class="funnel-subtitle">Pick the venue closest to you.</p>
                    </div>

                    <div class="funnel-options funnel-options-2">
                        <button class="funnel-option" onclick="selectLocation('townsville', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>Townsville</h3>
                                <p>40 Charles St, Aitkenvale QLD 4814</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>

                        <button class="funnel-option" onclick="selectLocation('widebay', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>Wide Bay</h3>
                                <p>60 John St, Maryborough QLD 4650</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>
                    </div>

                    <button class="funnel-back" onclick="goBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polyline points="15 18 9 12 15 6"/></svg>
                        Back
                    </button>
                </div>

                <!-- ===== STEP: Urgency ===== -->
                <div class="funnel-step" id="step-urgency">
                    <div class="funnel-step-header">
                        <h2 class="funnel-title">How Soon Do You Need Training?</h2>
                        <p class="funnel-subtitle">We'll prioritise urgent bookings and find you the earliest spot.</p>
                    </div>

                    <div class="funnel-options funnel-options-2">
                        <button class="funnel-option" onclick="selectUrgency('asap', this)">
                            <div class="funnel-option-icon" style="background: var(--red-light);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--red);"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>ASAP &mdash; Within a Week</h3>
                                <p>I need this urgently for work or compliance</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>

                        <button class="funnel-option" onclick="selectUrgency('flexible', this)">
                            <div class="funnel-option-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                            </div>
                            <div class="funnel-option-text">
                                <h3>I'm Flexible</h3>
                                <p>No rush &mdash; send me the next available dates</p>
                            </div>
                            <div class="funnel-option-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            </div>
                        </button>
                    </div>

                    <button class="funnel-back" onclick="goBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polyline points="15 18 9 12 15 6"/></svg>
                        Back
                    </button>
                </div>

                <!-- ===== STEP: Your Offer ===== -->
                <div class="funnel-step" id="step-offer">
                    <div id="offerContent">
                        <!-- Populated by JavaScript -->
                    </div>

                    <button class="funnel-back" onclick="goBack()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><polyline points="15 18 9 12 15 6"/></svg>
                        Back
                    </button>
                </div>

                <!-- ===== STEP: Booking Confirmed ===== -->
                <div class="funnel-step" id="step-confirmed">
                    <div id="confirmedContent">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <div class="logo-mark">+</div>
                        <div class="logo-text">
                            <span class="logo-name">Coral Sea Training</span>
                            <span class="logo-tagline">RTO #32221</span>
                        </div>
                    </a>
                    <p>Quality Training Generates Peace of Mind. Nationally accredited First Aid training in Queensland.</p>
                </div>
                <div class="footer-nav">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="courses.html">Our Courses</a></li>
                        <li><a href="shop.html">Shop</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-nav">
                    <h4>Courses</h4>
                    <ul>
                        <li><a href="courses.html">CPR (HLTAID009)</a></li>
                        <li><a href="courses.html">First Aid (HLTAID011)</a></li>
                        <li><a href="courses.html">Childcare (HLTAID012)</a></li>
                        <li><a href="courses.html">Advanced (HLTAID015)</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Contact</h4>
                    <p><strong>Townsville:</strong> <a href="tel:0419675022">0419 675 022</a></p>
                    <p><strong>Wide Bay:</strong> <a href="tel:0488488467">0488 488 467</a></p>
                    <p><a href="mailto:admin@coralseatraining.com.au">admin@coralseatraining.com.au</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Coral Sea Training. All rights reserved. RTO #32221</p>
                <p><a href="partner/">Partner Login</a> &middot; <a href="admin/">Admin</a></p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
    // =====================================================
    // Lead Qualification Funnel — Binary Decision Tree
    // =====================================================

    var funnelData = {
        type: '',       // individual | team
        industry: '',   // childcare | other (individual path)
        level: '',      // cpr | firstaid (individual non-childcare path)
        partner: '',    // yes | interested (team path)
        delivery: '',   // onsite | venue (team path)
        location: '',   // townsville | widebay | onsite
        urgency: '',    // asap | flexible
        name: '',
        email: '',
        phone: '',
        company: ''
    };

    var currentRec = null;
    var stepHistory = [];
    var currentStepId = 'step-type';

    // HTML escape to prevent XSS in user-supplied data
    function esc(str) {
        var div = document.createElement('div');
        div.textContent = str || '';
        return div.innerHTML;
    }

    // ---- Navigation ----

    function navigateTo(stepId) {
        document.querySelectorAll('.funnel-step').forEach(function(s) {
            s.classList.remove('active');
        });
        document.getElementById(stepId).classList.add('active');
        stepHistory.push(currentStepId);
        currentStepId = stepId;
        updateProgress();
        updateWrapperWidth();
        document.querySelector('.funnel-wrapper').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function goBack() {
        if (stepHistory.length === 0) return;
        var prevStep = stepHistory.pop();
        document.querySelectorAll('.funnel-step').forEach(function(s) {
            s.classList.remove('active');
        });
        document.getElementById(prevStep).classList.add('active');
        currentStepId = prevStep;
        updateProgress();
        updateWrapperWidth();
        document.querySelector('.funnel-wrapper').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function updateWrapperWidth() {
        var wrapper = document.querySelector('.funnel-wrapper');
        if (currentStepId === 'step-offer' || currentStepId === 'step-confirmed') {
            wrapper.classList.add('funnel-wrapper--wide');
        } else {
            wrapper.classList.remove('funnel-wrapper--wide');
        }
    }

    function updateProgress() {
        var stepsCompleted = stepHistory.length;
        var totalSteps = 5;
        if (funnelData.type === 'team') {
            totalSteps = (funnelData.delivery === 'onsite') ? 5 : 6;
        }

        if (currentStepId === 'step-confirmed') {
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('stepLabel').textContent = 'Booked!';
        } else if (currentStepId === 'step-offer') {
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('stepLabel').textContent = 'Your course';
        } else {
            var progress = ((stepsCompleted + 1) / totalSteps) * 100;
            document.getElementById('progressFill').style.width = Math.min(progress, 100) + '%';
            var labels = ['', 'Almost there', 'Nearly done', 'Last step'];
            var label = labels[stepsCompleted] || ('Step ' + (stepsCompleted + 1));
            document.getElementById('stepLabel').textContent = label;
        }
    }

    function highlightOption(btn) {
        var step = btn.closest('.funnel-step');
        step.querySelectorAll('.funnel-option').forEach(function(o) {
            o.classList.remove('selected');
        });
        btn.classList.add('selected');
    }

    // ---- Step Handlers ----

    function selectType(value, btn) {
        funnelData.type = value;
        highlightOption(btn);
        setTimeout(function() {
            if (value === 'individual') {
                navigateTo('step-industry');
            } else {
                navigateTo('step-partner');
            }
        }, 300);
    }

    function selectPartner(value, btn) {
        funnelData.partner = value;
        highlightOption(btn);
        setTimeout(function() {
            navigateTo('step-delivery');
        }, 300);
    }

    function selectIndustry(value, btn) {
        funnelData.industry = value;
        highlightOption(btn);
        setTimeout(function() {
            if (value === 'childcare') {
                navigateTo('step-location');
            } else {
                navigateTo('step-level');
            }
        }, 300);
    }

    function selectLevel(value, btn) {
        funnelData.level = value;
        highlightOption(btn);
        setTimeout(function() {
            navigateTo('step-location');
        }, 300);
    }

    function selectDelivery(value, btn) {
        funnelData.delivery = value;
        highlightOption(btn);
        setTimeout(function() {
            if (value === 'onsite') {
                funnelData.location = 'onsite';
                navigateTo('step-urgency');
            } else {
                navigateTo('step-location');
            }
        }, 300);
    }

    function selectLocation(value, btn) {
        funnelData.location = value;
        highlightOption(btn);
        setTimeout(function() {
            navigateTo('step-urgency');
        }, 300);
    }

    function selectUrgency(value, btn) {
        funnelData.urgency = value;
        highlightOption(btn);
        setTimeout(function() {
            showOffer();
        }, 300);
    }

    // ---- Offer Page ----

    function showOffer() {
        currentRec = getRecommendation();
        document.getElementById('offerContent').innerHTML = buildOfferHTML(currentRec);
        navigateTo('step-offer');
    }

    function getRecommendation() {
        var rec = {};

        if (funnelData.type === 'team') {
            rec.isTeam = true;
            rec.code = 'Participant Credits';
            rec.badge = 'Team Packages';
            rec.description = 'Buy participant credits and use them on any course &mdash; CPR, First Aid, or Childcare. ' + (funnelData.delivery === 'onsite' ? 'We bring everything to your workplace.' : 'Book your team into scheduled courses at our venue.');
            rec.duration = funnelData.delivery === 'onsite' ? 'Flexible &mdash; tailored to your team' : '1 day per course';
            rec.validity = 'Credits valid 12 months';
            rec.upsellCourse = null;
            rec.packages = [
                {
                    name: 'Small Team Package',
                    badge: 'Most Popular',
                    credits: 8,
                    price: 1497,
                    priceLabel: '$1,497',
                    perHead: '$187',
                    savings: 'Save $275 vs individual bookings',
                    includes: [
                        '8 participant credits (use on any course)',
                        funnelData.delivery === 'onsite' ? 'On-site training &mdash; we bring everything' : 'Venue-based training at our facility',
                        'Compliance certificates for every participant',
                        '"Save a Life" Learning Vault for every team member ($179/head value)',
                        '100% Compliance Guarantee',
                        'Expiry tracking &amp; renewal reminders'
                    ]
                },
                {
                    name: 'Platinum Enterprise',
                    badge: 'Best Value',
                    credits: 25,
                    price: 2997,
                    priceLabel: '$2,997',
                    perHead: '$120',
                    savings: 'Save $978 vs individual bookings',
                    includes: [
                        '25 participant credits (use on any course)',
                        funnelData.delivery === 'onsite' ? 'On-site training &mdash; we bring everything' : 'Venue-based training at our facility',
                        'Dedicated training coordinator',
                        '12-month compliance management',
                        'Annual renewal auto-scheduling',
                        '"Save a Life" Learning Vault for every team member ($179/head value)',
                        '100% Compliance Guarantee',
                        '30% discount on additional credits'
                    ]
                }
            ];
            rec.course = 'Team Training Credits';
            rec.price = null;
            rec.priceLabel = 'From $120/person';
            rec.includes = rec.packages[0].includes;
            rec.bonuses = [
                '100% Compliance Guarantee &mdash; we manage everything until your team passes',
                '"Save a Life" Learning Vault for every team member ($179/head value) FREE',
                'Expiry tracking &amp; renewal reminders for your whole team',
                'Priority rescheduling if dates change'
            ];
            rec.btnText = 'Get My Team Quote';
        } else {
            rec.isTeam = false;
            if (funnelData.industry === 'childcare') {
                rec.course = 'The Educator Shield';
                rec.code = 'HLTAID012';
                rec.badge = 'Recommended For You';
                rec.price = 199;
                rec.priceLabel = '$199';
                rec.anchorPrice = '$400+';
                rec.description = 'The complete ACECQA-approved package &mdash; CPR, First Aid, Anaphylaxis and Asthma all in one day. Everything required for Cert III, Diploma, and educator roles.';
                rec.duration = 'Approx. 8 hours (1 day)';
                rec.validity = '3 years (CPR renewed annually)';
                rec.includes = [
                    'CPR & AED (HLTAID009)',
                    'Provide First Aid (HLTAID011)',
                    'Anaphylaxis management',
                    'Asthma emergency response',
                    'ACECQA approved for childcare',
                    'Statement of Attainment on completion'
                ];
                rec.bonuses = [
                    'Three qualifications in a single day (worth $400+ separately)',
                    'Meets all ACECQA &amp; centre licensing requirements',
                    '"Save a Life" Learning Vault &mdash; video refreshers &amp; quick-reference guides ($179 value) FREE',
                    '100% Skills Mastery Guarantee &mdash; retrain free if you don\'t feel confident'
                ];
                rec.btnText = 'Book Now &mdash; $199';
                rec.totalValue = '$697';
                rec.valueStackItems = [
                    { item: 'Childcare First Aid Course', value: '$199' },
                    { item: '"Save a Life" Learning Vault', value: '$179' },
                    { item: 'ACECQA Compliance Verification', value: '$120' },
                    { item: 'Free Refresher Session (within 3 months)', value: '$79' },
                    { item: 'Skills Mastery Guarantee (retrain free)', value: '$79' },
                    { item: 'Renewal Reminders &amp; Expiry Tracking', value: '$41' }
                ];
                rec.upsellCourse = null;
            } else if (funnelData.level === 'cpr') {
                rec.course = 'The 2-Hour Lifesaver';
                rec.code = 'HLTAID009';
                rec.badge = 'Quick &amp; Easy';
                rec.price = 99;
                rec.priceLabel = '$99';
                rec.anchorPrice = '$140+';
                rec.description = 'Quick 3-hour refresh &mdash; perfect for your annual CPR renewal. You\'ll practise on mannequins and AED defibrillators with hands-on guidance.';
                rec.duration = 'Approx. 3 hours';
                rec.validity = '12 months';
                rec.includes = [
                    'Cardiopulmonary Resuscitation (CPR)',
                    'AED Defibrillator Training',
                    'Infant, child &amp; adult techniques',
                    'Practical assessment with feedback',
                    'Statement of Attainment on completion'
                ];
                rec.bonuses = [
                    '"Save a Life" Learning Vault &mdash; video refreshers &amp; quick-reference guides ($179 value) FREE',
                    'Free refresher session within 3 months if you want extra practice',
                    'Renewal reminder before your cert expires &mdash; never lapse',
                    '100% Skills Mastery Guarantee &mdash; retrain free if you don\'t feel confident'
                ];
                rec.btnText = 'Book Now &mdash; $99';
                rec.totalValue = '$396';
                rec.valueStackItems = [
                    { item: 'CPR &amp; AED Training Course', value: '$99' },
                    { item: '"Save a Life" Learning Vault', value: '$179' },
                    { item: 'Free Refresher Session (within 3 months)', value: '$79' },
                    { item: 'Renewal Reminder Service', value: '$39' }
                ];
                rec.upsellCourse = {
                    name: 'The Complete First Aider (HLTAID011)',
                    price: '$159',
                    pitch: 'Upgrade to full First Aid for just $60 more &mdash; includes CPR plus comprehensive workplace skills. Valid 3 years instead of 1.'
                };
            } else {
                rec.course = 'The Complete First Aider';
                rec.code = 'HLTAID011';
                rec.badge = 'Most Popular';
                rec.price = 159;
                rec.priceLabel = '$159';
                rec.anchorPrice = '$260';
                rec.description = 'Our most popular course. Includes CPR certification bundled in, plus comprehensive first aid skills. Nationally recognised and meets all workplace compliance requirements.';
                rec.duration = 'Approx. 7 hours (1 day)';
                rec.validity = '3 years (CPR renewed annually)';
                rec.includes = [
                    'CPR & AED (HLTAID009) included',
                    'Wound management & bandaging',
                    'Burns, bites & stings',
                    'Fractures & dislocations',
                    'Medical emergencies',
                    'Statement of Attainment on completion'
                ];
                rec.bonuses = [
                    'Two qualifications in one day (CPR + First Aid &mdash; worth $260 separately)',
                    '"Save a Life" Learning Vault &mdash; video refreshers &amp; quick-reference guides ($179 value) FREE',
                    'Free refresher session within 3 months if you want extra practice',
                    'Renewal reminder before your cert expires &mdash; never lapse',
                    '100% Skills Mastery Guarantee &mdash; retrain free if you don\'t feel confident'
                ];
                rec.btnText = 'Book Now &mdash; $159';
                rec.totalValue = '$557';
                rec.valueStackItems = [
                    { item: 'First Aid + CPR Course (2-in-1)', value: '$159' },
                    { item: '"Save a Life" Learning Vault', value: '$179' },
                    { item: 'Free Refresher Session (within 3 months)', value: '$79' },
                    { item: 'Skills Mastery Guarantee (retrain free)', value: '$79' },
                    { item: 'Renewal Reminders &amp; Expiry Tracking', value: '$41' },
                    { item: 'Forward-to-Employer Certificate', value: '$20' }
                ];
                rec.upsellCourse = null;
            }
        }

        // Location display
        if (funnelData.location === 'townsville') {
            rec.locationDisplay = 'Townsville &mdash; 40 Charles St, Aitkenvale';
        } else if (funnelData.location === 'widebay') {
            rec.locationDisplay = 'Wide Bay &mdash; 60 John St, Maryborough';
        } else {
            rec.locationDisplay = 'On-site at your workplace';
        }

        if (funnelData.urgency === 'asap') {
            rec.urgencyNote = 'Only <strong>4 spots left</strong> on the next available course. We\'ll lock in yours now.';
        } else {
            rec.urgencyNote = 'We\'ll send you upcoming dates so you can pick the one that works best.';
        }

        return rec;
    }

    function buildOfferHTML(rec) {
        var checkSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;color:var(--green);flex-shrink:0;"><polyline points="20 6 9 17 4 12"/></svg>';

        var includesHTML = '';
        for (var i = 0; i < rec.includes.length; i++) {
            includesHTML += '<div class="funnel-result-feature">' + checkSvg + '<span>' + rec.includes[i] + '</span></div>';
        }

        var bonusHTML = '';
        var bonusSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;color:var(--red);flex-shrink:0;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>';
        for (var j = 0; j < rec.bonuses.length; j++) {
            bonusHTML += '<div class="funnel-result-feature">' + bonusSvg + '<span><strong>' + rec.bonuses[j] + '</strong></span></div>';
        }

        // Upsell banner for CPR-only bookings
        var upsellHTML = '';
        if (rec.upsellCourse) {
            upsellHTML = '' +
                '<div class="funnel-offer-upsell">' +
                    '<div class="funnel-offer-upsell-badge">Upgrade Available</div>' +
                    '<h4>' + rec.upsellCourse.name + ' &mdash; ' + rec.upsellCourse.price + '</h4>' +
                    '<p>' + rec.upsellCourse.pitch + '</p>' +
                    '<button class="btn btn-outline" onclick="upgradeToFirstAid()" style="margin-top:var(--space-3);width:100%;">Upgrade to The Complete First Aider &mdash; $159</button>' +
                '</div>';
        }

        var companyFieldHTML = rec.isTeam
            ? '<div class="funnel-form-group"><input type="text" id="funnelCompany" class="form-input" placeholder="Company / Organisation *"></div>'
            : '';

        // Team package cards
        var teamPackagesHTML = '';
        if (rec.packages) {
            teamPackagesHTML = '<div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--space-4);margin-bottom:var(--space-6);">';
            for (var p = 0; p < rec.packages.length; p++) {
                var pkg = rec.packages[p];
                var isFeatured = p === 1;
                var pkgCheckSvg = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;color:var(--green);flex-shrink:0;"><polyline points="20 6 9 17 4 12"/></svg>';
                var pkgIncludes = '';
                for (var pi = 0; pi < pkg.includes.length; pi++) {
                    pkgIncludes += '<div style="display:flex;align-items:start;gap:6px;font-size:0.8125rem;color:var(--gray-700);margin-bottom:4px;">' + pkgCheckSvg + '<span>' + pkg.includes[pi] + '</span></div>';
                }
                teamPackagesHTML += '' +
                    '<div style="border:2px solid ' + (isFeatured ? 'var(--red)' : 'var(--gray-200)') + ';border-radius:12px;padding:var(--space-4);position:relative;' + (isFeatured ? 'background:var(--red-light);' : '') + '">' +
                        '<div style="position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:' + (isFeatured ? 'var(--red)' : 'var(--navy)') + ';color:white;font-size:0.6875rem;font-weight:700;padding:2px 10px;border-radius:20px;text-transform:uppercase;white-space:nowrap;">' + pkg.badge + '</div>' +
                        '<h4 style="font-family:var(--font-heading);font-size:1.125rem;color:var(--navy);margin-top:var(--space-2);margin-bottom:var(--space-1);">' + pkg.name + '</h4>' +
                        '<div style="font-size:0.8125rem;color:var(--green);font-weight:700;margin-bottom:var(--space-2);">' + pkg.credits + ' participant credits</div>' +
                        '<div style="display:flex;align-items:baseline;gap:6px;margin-bottom:2px;">' +
                            '<span style="font-size:1.75rem;font-weight:800;color:var(--navy);">' + pkg.priceLabel + '</span>' +
                        '</div>' +
                        '<div style="font-size:0.75rem;color:var(--gray-500);margin-bottom:var(--space-1);">' + pkg.perHead + '/person &bull; ' + pkg.savings + '</div>' +
                        '<hr style="border:none;border-top:1px solid var(--gray-200);margin:var(--space-3) 0;">' +
                        pkgIncludes +
                    '</div>';
            }
            teamPackagesHTML += '</div>';
        }

        // Itemized value stack for individual offers (Hormozi $100M Offers — break down every component)
        var valueStackHTML = '';
        if (rec.valueStackItems && !rec.isTeam) {
            var stackRows = '';
            for (var v = 0; v < rec.valueStackItems.length; v++) {
                stackRows += '<div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;' + (v < rec.valueStackItems.length - 1 ? 'border-bottom:1px solid var(--gray-200);' : '') + '">' +
                    '<span style="font-size:0.8125rem;color:var(--gray-700);">' + rec.valueStackItems[v].item + '</span>' +
                    '<span style="font-size:0.8125rem;font-weight:600;color:var(--gray-600);">' + rec.valueStackItems[v].value + '</span>' +
                '</div>';
            }
            valueStackHTML = '<div style="background:var(--gray-50);border:1px solid var(--gray-200);border-radius:10px;padding:var(--space-3) var(--space-4);margin-top:var(--space-4);">' +
                '<div style="font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.05em;color:var(--navy);margin-bottom:var(--space-2);">Everything You\'re Getting:</div>' +
                stackRows +
                '<div style="display:flex;justify-content:space-between;align-items:center;padding-top:var(--space-3);margin-top:var(--space-2);border-top:2px solid var(--navy);">' +
                    '<span style="font-size:0.875rem;font-weight:700;color:var(--gray-500);">Total Value</span>' +
                    '<span style="font-size:1.125rem;font-weight:800;color:var(--gray-400);text-decoration:line-through;">' + rec.totalValue + '</span>' +
                '</div>' +
                '<div style="display:flex;justify-content:space-between;align-items:center;padding-top:var(--space-1);">' +
                    '<span style="font-size:1rem;font-weight:800;color:var(--green);">Today\'s Price</span>' +
                    '<span style="font-size:1.5rem;font-weight:800;color:var(--green);">' + rec.priceLabel + '</span>' +
                '</div>' +
            '</div>';
        }

        var html = '' +
            '<div class="funnel-step-header">' +
                '<h2 class="funnel-title">Here\'s Your Perfect Match</h2>' +
                '<p class="funnel-subtitle">Based on your answers, this is the exact course you need.</p>' +
            '</div>' +

            (teamPackagesHTML ? teamPackagesHTML : '') +

            '<div class="funnel-offer-layout">' +

                '<div class="funnel-offer-main">' +
                    '<div class="funnel-result-card" style="margin-bottom:0;">' +
                        '<div class="funnel-result-badge">' + rec.badge + '</div>' +
                        '<h3 class="funnel-result-course">' + rec.course + '</h3>' +
                        (rec.code ? '<p style="font-size:0.8125rem;color:var(--gray-500);margin-top:2px;">' + rec.code + '</p>' : '') +
                        '<div class="funnel-offer-price">' +
                            (rec.anchorPrice ? '<span class="funnel-offer-price-anchor"><s>' + rec.anchorPrice + '</s> if bought separately</span>' : '') +
                            '<span class="funnel-offer-price-amount">' + rec.priceLabel + '</span>' +
                            '<span class="funnel-offer-price-sub">per person &bull; pay on the day</span>' +
                        '</div>' +
                        valueStackHTML +
                        '<div class="funnel-offer-meta-strip">' +
                            '<div class="funnel-offer-meta-item">' +
                                '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>' +
                                '<span>' + rec.duration + '</span>' +
                            '</div>' +
                            '<div class="funnel-offer-meta-item">' +
                                '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>' +
                                '<span>Valid ' + rec.validity + '</span>' +
                            '</div>' +
                            '<div class="funnel-offer-meta-item">' +
                                '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>' +
                                '<span>' + rec.locationDisplay + '</span>' +
                            '</div>' +
                        '</div>' +
                        '<div class="funnel-offer-guarantee-strip">' +
                            '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>' +
                            '<span><strong>100% Skills Mastery Guarantee</strong> &mdash; 98% pass first time. Don\'t feel confident? Come back and retrain free.</span>' +
                        '</div>' +
                    '</div>' +

                    upsellHTML +

                    // Social proof at decision point
                    '<div class="funnel-offer-social-proof">' +
                        '<div class="funnel-offer-review">' +
                            '<div class="funnel-offer-review-stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div>' +
                            '<p>&ldquo;First time feeling confident and not overwhelmed. The instructor gave confidence in the most important parts.&rdquo;</p>' +
                            '<span>&mdash; Jamie Lee, Google Review</span>' +
                        '</div>' +
                        '<div class="funnel-offer-review">' +
                            '<div class="funnel-offer-review-stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div>' +
                            '<p>&ldquo;Professional and thorough. I would recommend these guys in a heartbeat!&rdquo;</p>' +
                            '<span>&mdash; Caitlin Murrell, Google Review</span>' +
                        '</div>' +
                    '</div>' +
                '</div>' +

                '<div class="funnel-offer-sidebar">' +
                    '<div class="funnel-offer-form-card">' +
                        '<h3 class="funnel-offer-form-title">Reserve Your Spot</h3>' +
                        '<p class="funnel-offer-form-sub">No study required. Instant confirmation. Pay on the day.</p>' +
                        '<div class="funnel-form-group">' +
                            '<input type="text" id="funnelName" class="form-input" placeholder="Full name *" required>' +
                        '</div>' +
                        '<div class="funnel-form-row">' +
                            '<div class="funnel-form-group">' +
                                '<input type="tel" id="funnelPhone" class="form-input" placeholder="Phone *" required>' +
                            '</div>' +
                            '<div class="funnel-form-group">' +
                                '<input type="email" id="funnelEmail" class="form-input" placeholder="Email *" required>' +
                            '</div>' +
                        '</div>' +
                        companyFieldHTML +
                        '<button class="btn btn-primary btn-lg funnel-submit" onclick="submitBooking()" style="width:100%;font-size:1.125rem;">' +
                            rec.btnText +
                            ' <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:20px;height:20px;"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>' +
                        '</button>' +
                        '<div class="funnel-offer-form-trust">' +
                            '<span>&#10003; Instant confirmation</span>' +
                            '<span>&#10003; Pay on the day</span>' +
                            '<span>&#10003; Forward to employer</span>' +
                        '</div>' +
                        (!rec.isTeam ? '<p class="funnel-offer-mate-deal" style="text-align:center;font-size:0.8125rem;color:var(--gray-600);margin-top:var(--space-3);"><strong style="color:var(--navy);">Bring a mate?</strong> Book together and train side by side &mdash; call <a href="tel:0419675022" style="color:var(--red);font-weight:600;">0419 675 022</a> for group pricing.</p>' : '') +
                    '</div>' +
                    '<div class="funnel-offer-urgency-strip"><p>' + rec.urgencyNote + '</p></div>' +
                '</div>' +

            '</div>' +

            '<div class="funnel-offer-details">' +
                '<div class="funnel-offer-details-col">' +
                    '<h4>What\'s Included</h4>' +
                    includesHTML +
                '</div>' +
                '<div class="funnel-offer-details-col">' +
                    '<h4>Bonuses &mdash; Included Free</h4>' +
                    bonusHTML +
                '</div>' +
            '</div>';

        return html;
    }

    // Upgrade from CPR to First Aid (upsell)
    function upgradeToFirstAid() {
        funnelData.level = 'firstaid';
        showOffer();
    }

    // ---- Submit Booking ----

    function submitBooking() {
        var name = document.getElementById('funnelName').value.trim();
        var email = document.getElementById('funnelEmail').value.trim();
        var phone = document.getElementById('funnelPhone').value.trim();
        var companyEl = document.getElementById('funnelCompany');
        var company = companyEl ? companyEl.value.trim() : '';

        if (!name) { shakeField('funnelName'); return; }
        if (!email || email.indexOf('@') === -1) { shakeField('funnelEmail'); return; }
        if (!phone) { shakeField('funnelPhone'); return; }

        funnelData.name = name;
        funnelData.email = email;
        funnelData.phone = phone;
        funnelData.company = company;

        sendBookingEmail(currentRec);
        document.getElementById('confirmedContent').innerHTML = buildConfirmedHTML(currentRec);
        navigateTo('step-confirmed');
    }

    function shakeField(id) {
        var el = document.getElementById(id);
        el.style.borderColor = 'var(--red)';
        el.focus();
        el.classList.add('shake');
        setTimeout(function() { el.classList.remove('shake'); }, 500);
    }

    function buildConfirmedHTML(rec) {
        var firstName = funnelData.name.split(' ')[0];

        // Build upsell section based on what they booked
        var postBookUpsell = '';
        if (rec.code === 'HLTAID009') {
            // CPR only — upsell to full first aid
            postBookUpsell = '' +
                '<div class="funnel-confirmed-upsell">' +
                    '<h4>Want the Full Certification?</h4>' +
                    '<p>Upgrade to <strong>The Complete First Aider (HLTAID011)</strong> for just $60 more. You\'ll get CPR <em>plus</em> comprehensive workplace skills &mdash; and it\'s valid for 3 years instead of 1. Call us to upgrade your booking.</p>' +
                    '<a href="tel:0419675022" class="btn btn-primary" style="margin-top:var(--space-3);">Call to Upgrade &mdash; 0419 675 022</a>' +
                '</div>';
        } else if (!rec.isTeam) {
            // Individual booking — cross-sell first aid kit
            postBookUpsell = '' +
                '<div class="funnel-confirmed-upsell">' +
                    '<h4>Complete Your Preparation</h4>' +
                    '<p>You\'re getting the training &mdash; make sure you have the gear too. Our workplace-compliant first aid kits are built for real emergencies, not just ticking a box.</p>' +
                    '<a href="shop.html" class="btn btn-primary" style="margin-top:var(--space-3);">Browse First Aid Kits</a>' +
                '</div>';
        }

        return '' +
            '<div class="funnel-result-success">' +
                '<div class="funnel-result-check">' +
                    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>' +
                '</div>' +
                '<h2>You\'re Booked, ' + esc(firstName) + '!</h2>' +
                '<p>Your spot for <strong>' + esc(rec.course) + '</strong> has been secured.</p>' +
            '</div>' +

            '<div class="funnel-result-card">' +
                '<div class="funnel-result-confirmation" style="margin-bottom:var(--space-4);border:none;background:var(--green-light);">' +
                    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:20px;height:20px;color:var(--green);flex-shrink:0;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>' +
                    '<p><strong>Booking confirmation has been sent.</strong> Check your email at <strong>' + esc(funnelData.email) + '</strong> &mdash; forward it to your employer for approval if needed.</p>' +
                '</div>' +

                '<div class="funnel-result-meta">' +
                    '<div class="funnel-result-meta-item">' +
                        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;color:var(--red);"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>' +
                        '<div><strong>Course:</strong> ' + esc(rec.course) + ' (' + esc(rec.code) + ')</div>' +
                    '</div>' +
                    '<div class="funnel-result-meta-item">' +
                        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;color:var(--red);"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>' +
                        '<div><strong>Location:</strong> ' + esc(rec.locationDisplay) + '</div>' +
                    '</div>' +
                    (rec.price ? '<div class="funnel-result-meta-item"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;color:var(--red);"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg><div><strong>Price:</strong> ' + esc(rec.priceLabel) + ' (pay on the day)</div></div>' : '') +
                '</div>' +

                '<div class="funnel-result-next-steps" style="margin-top:var(--space-6);">' +
                    '<h4>What Happens Next?</h4>' +
                    '<div class="funnel-result-step"><span class="funnel-result-step-num">1</span><p><strong>We\'ll call you within 2 hours</strong> to confirm your course date and answer any questions</p></div>' +
                    '<div class="funnel-result-step"><span class="funnel-result-step-num">2</span><p>You\'ll get a reminder before the day with everything you need to know</p></div>' +
                    '<div class="funnel-result-step"><span class="funnel-result-step-num">3</span><p>Show up, get trained, leave certified &mdash; pay on the day</p></div>' +
                '</div>' +
            '</div>' +

            postBookUpsell +

            // Renewal lock-in (Hormozi Money Model — continuity / purchase frequency)
            (rec.isTeam
                ? '<div style="background:linear-gradient(135deg,var(--navy) 0%,#243447 100%);border-radius:12px;padding:var(--space-6);margin-top:var(--space-6);color:white;text-align:center;">' +
                    '<h4 style="font-family:var(--font-heading);font-size:1.25rem;margin-bottom:var(--space-2);">Set Up an Annual Training Agreement</h4>' +
                    '<p style="font-size:0.9375rem;color:rgba(255,255,255,0.85);margin-bottom:var(--space-3);">Your team\'s CPR expires in 12 months. Instead of scrambling each year, let us handle it. We\'ll auto-schedule renewals, track every cert, and keep your business compliant year-round &mdash; one annual partnership, zero admin for you.</p>' +
                    '<a href="tel:0419675022" class="btn btn-white" style="font-size:0.9375rem;">Call to Set Up Annual Agreement</a>' +
                  '</div>'
                : '<div style="background:var(--gray-50);border:1px solid var(--gray-200);border-radius:12px;padding:var(--space-5);margin-top:var(--space-6);text-align:center;">' +
                    '<h4 style="font-family:var(--font-heading);font-size:1.125rem;color:var(--navy);margin-bottom:var(--space-2);">Your Renewal is Already Sorted</h4>' +
                    '<p style="font-size:0.9375rem;color:var(--gray-600);">Your ' + (rec.code === 'HLTAID009' ? 'CPR cert expires in <strong>12 months</strong>' : 'CPR component expires in <strong>12 months</strong> (full cert valid 3 years)') + '. We\'ll send you a reminder 4 weeks before it\'s due so you never lapse. Same trainer, same easy process &mdash; just show up again.</p>' +
                  '</div>'
            ) +

            // Referral prompt (Hormozi $100M Leads — cheapest leads come from buyers)
            '<div class="funnel-confirmed-referral" style="background:var(--gray-50);border:1px solid var(--gray-200);border-radius:12px;padding:var(--space-5);margin-top:var(--space-6);text-align:center;">' +
                '<h4 style="font-family:var(--font-heading);font-size:1.125rem;color:var(--navy);margin-bottom:var(--space-2);">Know Someone Who Needs Their First Aid?</h4>' +
                '<p style="font-size:0.9375rem;color:var(--gray-600);margin-bottom:var(--space-3);">Send them this page &mdash; they\'ll thank you when they\'re the one who knows what to do in an emergency.</p>' +
                '<button class="btn btn-outline" onclick="copyFunnelLink()" id="copyLinkBtn" style="font-size:0.875rem;">Copy Link to Share</button>' +
            '</div>' +

            // Fallback contact (for unreliable mailto delivery)
            '<div style="background:var(--red-light);border:1px solid #fca5a5;border-radius:12px;padding:var(--space-4);margin-top:var(--space-4);text-align:center;">' +
                '<p style="font-size:0.875rem;color:var(--gray-700);"><strong>Didn\'t receive a confirmation email?</strong> No worries &mdash; your booking is logged. Call <a href="tel:0419675022" style="color:var(--red);font-weight:600;">0419 675 022</a> or email <a href="mailto:admin@coralseatraining.com.au" style="color:var(--red);font-weight:600;">admin@coralseatraining.com.au</a> to verify.</p>' +
            '</div>' +

            '<div class="funnel-result-cta-row">' +
                '<a href="tel:0419675022" class="btn btn-primary btn-lg">' +
                    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:20px;height:20px;"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>' +
                    'Questions? Call Us' +
                '</a>' +
                '<a href="index.html" class="btn btn-outline btn-lg">Back to Homepage</a>' +
            '</div>';
    }

    function copyFunnelLink() {
        var url = window.location.origin + '/courses.html';
        if (navigator.clipboard) {
            navigator.clipboard.writeText(url).then(function() {
                var btn = document.getElementById('copyLinkBtn');
                btn.textContent = 'Link Copied!';
                setTimeout(function() { btn.textContent = 'Copy Link to Share'; }, 2000);
            });
        }
    }

    function sendBookingEmail(rec) {
        var situationLabel = funnelData.type === 'individual'
            ? (funnelData.industry === 'childcare' ? 'Individual - Childcare/Education' : 'Individual - General/Workplace')
            : (funnelData.delivery === 'onsite' ? 'Team - On-site Training' : 'Team - Venue Booking');

        var partnerLabel = '';
        if (funnelData.partner === 'yes') {
            partnerLabel = 'Existing Partner';
        } else if (funnelData.partner === 'interested') {
            partnerLabel = 'Interested in Partnership';
        }

        var subject = encodeURIComponent('NEW BOOKING: ' + rec.course + ' - ' + funnelData.name);
        var body = encodeURIComponent(
            'NEW BOOKING FROM WEBSITE\n' +
            '================================\n\n' +
            'Name: ' + funnelData.name + '\n' +
            'Email: ' + funnelData.email + '\n' +
            'Phone: ' + funnelData.phone + '\n' +
            (funnelData.company ? 'Company: ' + funnelData.company + '\n' : '') +
            '\n' +
            'BOOKING DETAILS\n' +
            '--------------------------------\n' +
            'Course: ' + rec.course + ' (' + rec.code + ')\n' +
            (rec.price ? 'Price: ' + rec.priceLabel + '\n' : '') +
            'Type: ' + situationLabel + '\n' +
            (partnerLabel ? 'Partner Status: ' + partnerLabel + '\n' : '') +
            'Preferred Location: ' + funnelData.location + '\n' +
            'Urgency: ' + funnelData.urgency + '\n' +
            '\n' +
            'ACTION REQUIRED: Please confirm course date and send booking details to the student.'
        );

        var mailtoLink = 'mailto:admin@coralseatraining.com.au?subject=' + subject + '&body=' + body;
        var iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = mailtoLink;
        document.body.appendChild(iframe);
        setTimeout(function() { document.body.removeChild(iframe); }, 2000);

        // Analytics event only — no PII logged to console
        if (typeof gtag !== 'undefined') {
            gtag('event', 'purchase', {
                'event_category': 'Booking',
                'event_label': rec.course,
                'value': rec.price || 0
            });
        }
    }
    </script>
</body>
</html>
